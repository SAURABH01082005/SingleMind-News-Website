<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SingleMind News</title>
  <link rel="stylesheet" href="style.css" />

</head>
<body>
  <div class="content-wrapper">
        <header>
          <!-- <h1>üì∞ SingleMind News</h1> -->
           <img src="./images/hamburgur.png" id="hamburgur" alt="hamburgur" onclick="openSidebar()">
          <img src="./images/singlemind.png" alt="singlemindimg">

            <div id="sidebar" class="sidebar">
              <a href="#">üè† Home</a>
              <a href="#">üî• Trending</a>
              <a href="#">üì∫ Subscriptions</a>
              <a href="#">‚≠ê Library</a>
            </div>
            <!-- Overlay -->
            <div id="overlay" class="overlay" onclick="closeSidebar()"></div>

            <div class="dragStoreBox"><p>Drop Here to Save!</p>
              <img src="./images/royalborder.png" alt="image">
            </div>

       


          <nav class="navbar">
          <ul>
            <li><a href="index.html" class="active">Home</a></li>

            <li><a href="World.html">World</a></li>
            <li><a href="Technology.html">Technology</a></li>
            <li><a href="Business.html">Business</a></li>
            <li><a href="Science.html">Science</a></li>
            <li><a href="Health.html">Health</a></li>
            <li><a href="Sports.html">Sports</a></li>
            
            

          </ul>
        </nav>
        


        <div class="brain"><img src="./images/brain.png" alt="brainimg" class="brainimg"><p>More</p></div>
             <div class="menu">
          <a href="./feeder.html">Feeder</a>
          <a href="#">About</a>
          <a href="./account.html">Account</a>
          <a href="#">Contact</a>
          <a href="#" id="logoutpage">Logout</a>
          </div>   
        </header>

      

        <main id="news-container">
          
          <!-- <canvas id="newsCanvas" width="700" height="150"></canvas> -->
         


            <div class="table-wrapper">
              <table id="newsTable">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Summary</th>
                    <th>Category</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- JS will insert rows -->

                </tbody>
              </table>
            </div>

        </main>

        <div class="showlink" >this is your link.........</div>

        <footer>
          <p>&copy; 2025 SingleMind News. All rights reserved.</p>
        </footer> 
      

  </div>
<script>
   // Canvas Output
                    const canvas = document.getElementById("newsCanvas");
                    const ctx = canvas.getContext("2d");
                    ctx.font = "20px Segoe UI";
                    ctx.fillStyle = "#000";
                    ctx.fillText("Welcome to SingleMind News!", 20, 50);
                    ctx.fillStyle = "red";
                    ctx.fillText("No Ads. No Distractions. Just News.", 20, 100);
</script>
<script>
  function openSidebar(){
    document.querySelector("#sidebar").style.left="0px"
    document.querySelector("#overlay").style.display="block"
  }
  function closeSidebar(){
    document.querySelector("#overlay").style.display="none"
    document.querySelector("#sidebar").style.left="-250px"
  }
</script>
  <script>
    let logoutpage=document.getElementById("logoutpage")
    logoutpage.addEventListener("click",(event)=>{
      localStorage.removeItem("loggedInUser")
      console.log("user session remove and logout..........")
      event.preventDefault(); 
      location.replace('login2.html')
      // window.location.href="./login2.html"//not working ...
    })
  </script>


<script type="module">
const  loggedInUser = localStorage.getItem("loggedInUser");
// const loggedInUser="manoj"
console.log("checking session ",loggedInUser)


  //**********************************firebase sdks ****************************************
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  arrayUnion
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC5WPwC7kSpMvVzP8uSwOOOhAx6p52B3z8",
    authDomain: "singlemind-97876.firebaseapp.com",
    projectId: "singlemind-97876",
    storageBucket: "singlemind-97876.firebasestorage.app",
    messagingSenderId: "445373825721",
    appId: "1:445373825721:web:b5ab921e6a7ad577101168"
  };
//***********************************firebase sdk end***********************************
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
   



//**************fetching data rss**************
async function myfunction(k) {
const docRef = doc(db, "users", loggedInUser);
try {
  const docSnap = await getDoc(docRef);

if (docSnap.exists()) {
  console.log("Document data:", docSnap.data());
  if(k=='urls') return docSnap.data().urls
  
   
} else {

  console.log("No such document!");
}
  
} catch (error) {
 console.log("some error")
  
}
  
}
async function caller(params) {
  const k= await myfunction("urls");
console.log("k is ",typeof(k), k)


  //step1 use rssUrl ********************************fetching news**************************************
    let urlArray=k
    let count=0;
    let rssUrl = urlArray[count].url;
    while(rssUrl){
    count++
    // console.log(" the current fetching url is ",rssUrl)

                   
  // Step 2: Use rss2json proxy to get JSON data
  const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}&count=10`;
  console.log(apiUrl);

  // Fetch the RSS data
  await fetch(apiUrl)
    .then(response => response.json())//convertin to json
    .then(data => {
      console.log("data in json format is ",data)//printing data json and no. of items
      console.log(`Total items: ${data.items.length}`);
      const tableBody = document.querySelector('#newsTable tbody');
      //****************************************work to have catagory starts********************
      const link=data.feed.link
      console.log(link,"linkArray is ",link.split('/'))
      const linkArray=link.split('/')
      
      
      let catagoryNews=linkArray[linkArray.length-1]
      let catagoryLink=linkArray[linkArray.length-2]
      if(!linkArray[linkArray.length-1]){
        catagoryNews=linkArray[linkArray.length-2]
        catagoryLink=linkArray[linkArray.length-3]
      }
    //not using linkArray
      

      //****************************************work to have catagory ends********************
    
      data.items.forEach(news => {
       
        //showlinkUrl
        let showlinkUrl=news.link;
        // console.log("showlinkUrl is ",showlinkUrl)
        const row = document.createElement('tr');

        // Image cell
        const imageCell = document.createElement('td');
        const img = document.createElement('img');
        img.draggable='true'
        img.src = news.enclosure?.link || "./images/default_img.png" ;
        img.alt = "Image not loaded";
        img.style.width = "200px";
        img.className="rowimg"
        imageCell.appendChild(img);
        row.appendChild(imageCell);//appeding img

        // Other columns// appending rest of data
        //removing img form discription if exist
        const temp=document.createElement("div")
        temp.innerHTML=news.description
        temp.querySelectorAll("img").forEach(img=> img.remove())
        const discriptionNews=temp.textContent;
        // console.log("text content of descriptino is :",temp.innerText)
        row.innerHTML += `
          <td>${news.title}</td>
          <td>${discriptionNews}</td>
          <td>${catagoryNews}</td>
          <td>${news.pubDate}</td>
        `;

        tableBody.appendChild(row);//row append
       
        
//adding news link info starts*******************


let showlink=document.querySelector('.showlink'); 
row.addEventListener("mouseover",(event)=>{
  showlink.innerHTML = `<a href='${showlinkUrl}' style='text-decoration: none;color:black;'>${link}</a>`;
  showlink.style.display='block'
  // showlink.style.pointerEvents = "none"; 
  document.body.appendChild(showlink)
  moveTooltip(event);


})


row.addEventListener("mouseout", () => {
  showlink.style.display='none';

});
showlink.addEventListener("mouseover",(event)=>{
   showlink.style.display='block';
  //  console.log("hovering in showlingk box")

})

function moveTooltip(event){
   showlink.style.top=(event.pageY+10) +"px"
  showlink.style.left=(event.pageX+10)+"px"
}

//dragging the img---------------------------------starts
let dragStoreBox=document.querySelector(".dragStoreBox")
row.addEventListener("dragstart",(event)=>{
  console.log("image is dragging-----------")
  dragStoreBox.classList.add("showDragStore")
  var showlinkUrlGobal =showlinkUrl;
  console.log("after image is dragging")

  event.dataTransfer.setData("text/plain", JSON.stringify(news))//dataTransfer only take string//convert obj into json format and then string
 
  event.dataTransfer.setData("text/catagoryNews",catagoryNews)
  
})


//dragging the img---------------------------------ends





//adding news link info ends*******************

        
      });
    })
    .catch(error => {
      console.error('Error fetching news:', error);
    });
rssUrl = urlArray[count].url;  
}
}


caller()

let dragStoreBox=document.querySelector(".dragStoreBox")
dragStoreBox.addEventListener("dragover",(event)=>{
  event.preventDefault()

})
dragStoreBox.addEventListener("drop",(event)=>{
  dragStoreBox.classList.remove("showDragStore")
  const droppedUrl = event.dataTransfer.getData("text/plain")
  
  const catagoryNews = event.dataTransfer.getData("text/catagoryNews")
  let temp=JSON.parse(droppedUrl)
  
  temp.catagoryNews=catagoryNews
  console.log("this is before stringify ..............",temp)
  updateDrag(JSON.stringify(temp))//parsing required on other end
 
  
})

async function updateDrag(k){
  const docRef = await doc(db, "users", loggedInUser);
  console.log("saved element is ",JSON.parse(k))
  try {
        await updateDoc(docRef, {
        bookmarks: arrayUnion(k)
        
        
        });
        alert("successfully added")

        } catch (error) {
        console.log("Updation failed!!!",error)
        alert("unsuccesfull")

        }

}




</script>



              
</body>
</html>
