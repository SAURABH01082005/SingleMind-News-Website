<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SingleMind News</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="./commoncss.css">
</head>
<body>
  <div class="content-wrapper">
        <header>
          <!-- <h1>üì∞ SingleMind News</h1> -->
           <img src="./images/hamburgur.png" id="hamburgur" alt="hamburgur" onclick="openSidebar()">
          <img src="./images/singlemind.png" alt="singlemindimg">

            <div id="sidebar" class="sidebar">
              <a href="#">üè† Home</a>
              <a href="#">üî• Trending</a>
              <a href="#">üì∫ Subscriptions</a>
              <a href="#">‚≠ê Library</a>
            </div>
            <!-- Overlay -->
            <div id="overlay" class="overlay" onclick="closeSidebar()"></div>

            <div class="dragStoreBox"><p>Drop Here to Save!</p>
              <img src="./images/royalborder.png" alt="image">
            </div>

       


          <nav class="navbar">
          <ul>
            <li><a href="index.html" class="active">Home</a></li>
            <li><a href="#" onclick="moduleNews('broad','world')">World</a></li>
            <li><a href="#" onclick="moduleNews('broad','national')">National</a></li>
            <li><a href="#" onclick="moduleNews('broad','politics')">Politics</a></li>
            <li><a href="#" onclick="moduleNews('broad','business')">Business</a></li>
            <li><a href="#" onclick="moduleNews('broad','science_tech')" >Science_Tech</a></li>
            <li><a href="#" onclick="moduleNews('broad','health')">Health</a></li>
            <li><a href="#" onclick="moduleNews('broad','lifestyle')">LifeStyle</a></li>
            

          </ul>
         
        </nav>
        


        <div class="brain"><img src="./images/brain.png" alt="brainimg" class="brainimg"><p>More</p></div>
             <div class="menu">
          <a href="./feeder.html">Feeder</a>
          <a href="./about.html">About</a>
          <a href="./account.html">Account</a>
          <a href="./contact.html">Contact</a>
          <a href="#" id="logoutpage">Logout</a>
          </div>   
        </header>
         <div class="detailoptions">
          <ul>
            <!-- inserted by js code  -->

          </ul>
          </div>

      

        <main id="news-container">
          
          <canvas id="newsCanvas" width="800px" height="200px" ></canvas>
         


            <div class="table-wrapper">
              <table id="newsTable">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Summary</th>
                    <th>Category</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- JS will insert rows -->

                </tbody>
              </table>
            </div>

        </main>

        <div class="showlink" >this is your link.........</div>
         <button id="scrollTopBtn">‚¨Ü Top</button>

        
      <footer>
          <p>&copy; 2025 SingleMind News. All rights reserved.</p>
        </footer> 

  </div>
  

<script>
  function openSidebar(){
    document.querySelector("#sidebar").style.left="0px"
    document.querySelector("#overlay").style.display="block"
  }
  function closeSidebar(){
    document.querySelector("#overlay").style.display="none"
    document.querySelector("#sidebar").style.left="-250px"
  }
  function moduleNews(type,catNews){
    localStorage.setItem("catagoryType",type)
    localStorage.setItem("catagory",catNews)
    location.href="./moduleNews.html"
  }


    
</script>

<script type="module">
  import{logoutButtonPressed,imgDraggingStarts,
        imgDraggingStartsRemaining,
        tooltipShow,
        readData,
        catagoryNewsFunc,
        getKeywords,
        canvasShow,
        scrollTop,
        showDetailOptions,
        } from './commonscript.js'


const  loggedInUser = localStorage.getItem("loggedInUser");
// const loggedInUser="manoj"
console.log("Session is created of user ",loggedInUser)
logoutButtonPressed()
scrollTop()
showDetailOptions()


  
  //**********************************firebase sdks ****************************************
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  arrayUnion
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC5WPwC7kSpMvVzP8uSwOOOhAx6p52B3z8",
    authDomain: "singlemind-97876.firebaseapp.com",
    projectId: "singlemind-97876",
    storageBucket: "singlemind-97876.firebasestorage.app",
    messagingSenderId: "445373825721",
    appId: "1:445373825721:web:b5ab921e6a7ad577101168"
  };
//***********************************firebase sdk end***********************************
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
   



//**************fetching data rss**************
async function caller() {
const k= await readData("urls",db,loggedInUser).catch(err =>{console.log("there is error",err)});
// console.log("k is ",typeof(k), k)

  //step1 use rssUrl ********************************fetching news**************************************
    let urlArray=k
    let count=0;
    let rssUrl;
    // console.log("urlArray is ; ",urlArray.length)
    for(count=0;count<urlArray.length;count++){
      
    rssUrl = urlArray[count].url;
                   
  // Step 2: Use rss2json proxy to get JSON data
  const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}&count=10`;
  console.log(apiUrl);

  // Fetch the RSS data
  await fetch(apiUrl)
    .then(response => response.json())//convertin to json
    .then(data => {
      console.log("data in json format is ",data)//printing data json and no. of items
      console.log(`Total items: ${data.items.length}`);
      const tableBody = document.querySelector('#newsTable tbody');
      //****************************************work to have catagory starts********************
      const link=data.feed.link
      let catagoryNews=catagoryNewsFunc(link)
      // console.log("catagory news is : ",catagoryNews)
    //not using linkArray
      

      //****************************************work to have catagory ends********************
    
      data.items.forEach(news => {
       
        //showlinkUrl
        let showlinkUrl=news.link;
        // console.log("showlinkUrl is ",showlinkUrl)
        const row = document.createElement('tr');

        // Image cell
        const imageCell = document.createElement('td');
        const img = document.createElement('img');
        img.draggable='true'
        img.src = news.enclosure?.link || "./images/default_img.png" ;
        img.alt = "Image not loaded";
        img.style.width = "200px";
        img.className="rowimg"
        imageCell.appendChild(img);
        row.appendChild(imageCell);//appeding img

        // Other columns// appending rest of data
        //removing img form discription if exist
        const temp=document.createElement("div")
        temp.innerHTML=news.description
        temp.querySelectorAll("img").forEach(img=> img.remove())
        const discriptionNews=temp.textContent;
        // console.log("text content of descriptino is :",temp.innerText)
        row.innerHTML += `
          <td>${news.title}</td>
          <td>${discriptionNews}</td>
          <td>${catagoryNews}</td>
          <td>${news.pubDate}</td>
        `;

        tableBody.appendChild(row);//row append
             
//adding news link info starts*******************
 tooltipShow(row,showlinkUrl,link)
//adding news link info ends*******************

//dragging the img---------------------------------starts
imgDraggingStarts(row,news,link,catagoryNews)
//dragging the img---------------------------------ends

        
      });
    })
    .catch(error => {
      console.error('Error fetching news:', error);
    });
  
}
}

imgDraggingStartsRemaining(db,loggedInUser)
async function a(){

 await caller()
  
  

  let catagoryPage=""
  canvasShow(catagoryPage)

}
a()



</script>
            
</body>
</html>
