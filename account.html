<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Account - SingleMind News</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="commoncss.css">
  <style>
   body {
        font-family: Arial, sans-serif;
        background: #0d1b2a;
        color: white;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
    }
   
    .content-wrapper-inside {
        /* position: absolute; */
        margin:auto;
      margin-top: 70px;
      max-width: 1400px;
      background: #fff;
      color: #222;
      background-color: #cccccc;
      border-radius: 12px;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.3);
      
    }
   .content-wrapper-inside main{
    max-width: 1400px;
        width: 1360px;
    }
    .table-wrapper{
        margin: auto;
        width: 95%;

    }

    .account-header {
      text-align: center;
   
      margin-top: 40px;
    }

    .account-header h2{
      margin: 0;
      font-size: 2rem;
      color: #225192;
    }

    .account-header p {
      color: #555;
      margin-top: 8px;
    }
    .delete-btn {
      background-color: #ff4d4d;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background-color: #e60000;
    }
        header {
        background: #194A8D;
        padding: 15px 20px;
        text-align: center;
        font-size: 1.5rem;
        font-weight: bold;
        letter-spacing: 2px;
        height: 80px;
        display: flex;
        justify-content: center;
        align-items: center;
       
    }
    .trash{
      position: absolute;
      left: 1250px;
      top: 220px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 50px;
      width: 200px;
      cursor: pointer;

    }
    .trash img{
      height:40px;
      max-width: 60px;
    }

  </style>
</head>
<body>
    <header>SingleMind News - Account Panel</header>

  <div class="content-wrapper">
    <div class="content-wrapper-inside">
        <div class="account-header">
      <h2 >ðŸ‘¤<span class="username">My Account</span></h2>
      <p>Welcome back, <span class="username">John Doe</span></p>
    </div>

    <h3>ðŸ”– My Bookmarked News</h3>
    <div class="trash"><img src="./images/trash.png" alt="png" ><p>Delete Account</p></div>
   <main id="news-container">
          
          <canvas id="newsCanvas" width="800px" height="200px" ></canvas>
         


            <div class="table-wrapper">
              <table id="newsTable">
                <thead>
                  <tr>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Summary</th>
                    <th>Category</th>
                    <th>Date</th>
                    <th>Actions</th> 
                  </tr>
                </thead>
                <tbody>
                  <!-- JS will insert rows -->

                </tbody>
              </table>
            </div>

        </main>
    </div>
         <div class="showlink" >this is your link.........</div>
         <button id="scrollTopBtn">â¬† Top</button>

        
      <footer>
          <p>&copy; 2025 SingleMind News. All rights reserved.</p>
        </footer> 
  </div>
  

  <script>
  </script>

<script type="module">  
 import{logoutButtonPressed,
        tooltipShow,
        readData,
        scrollTop,
        } from './commonscript.js'

scrollTop()
const  loggedInUser = localStorage.getItem("loggedInUser");
// const loggedInUser="manoj kurmar yadav"
console.log("checking session ",loggedInUser)
let name=document.querySelectorAll(".username")

name[0].innerText=capitalize(loggedInUser)
name[1].innerText=capitalize(loggedInUser)

function capitalize(l){
 let k= l.split(" ").map(element =>{
  let a=element.split("")
  a[0]=a[0].toUpperCase()

      return a.join("")

  })
  return k.join(" ")
  
}

  //**********************************firebase sdks ****************************************
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  arrayUnion,
  arrayRemove,
  deleteDoc,
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC5WPwC7kSpMvVzP8uSwOOOhAx6p52B3z8",
    authDomain: "singlemind-97876.firebaseapp.com",
    projectId: "singlemind-97876",
    storageBucket: "singlemind-97876.firebasestorage.app",
    messagingSenderId: "445373825721",
    appId: "1:445373825721:web:b5ab921e6a7ad577101168"
  };
//***********************************firebase sdk end***********************************
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
   

//deleting account **********************************************starts**********
async function deleteAccount(event){
  const docRef=doc(db,"users",loggedInUser)
  try{
    
    if(loggedInUser=="manoj"){
       alert("sorry this account is restricted!")
       return;
    }
    await deleteDoc(docRef)
    alert("Account Deleted and Logout Succesfully")
    localStorage.clear();
    event.preventDefault(); 
    location.replace('login2.html')

  }catch (err){
    console.log("Error while deleting , not deleted ,err is : ",err)

  }
  

}
let delaccount=document.querySelector(".trash")
delaccount.addEventListener("click",(event)=>{
  deleteAccount(event)
})

//deleting account **********************************************ends**********

//**************fetching data rss**************

async function caller(params) {
 const bookmarks= await readData("bookmarks",db,loggedInUser);
 let tableBody=document.querySelector("tbody")
 tableBody.innerHTML = "";
// console.log("bookmarks is ",typeof(bookmarks), bookmarks)
bookmarks.forEach(async k => {
  
  let news= JSON.parse(k)
  console.log("news is ",news)
  const row = document.createElement('tr');

        // Image cell
        const imageCell = document.createElement('td');
        const img = document.createElement('img');
        img.src = news.enclosure?.link || "./images/default_img.png" ;
        img.alt = "Image not loaded";
        img.style.width = "200px";
        img.className="rowimg"
        imageCell.appendChild(img);
        row.appendChild(imageCell);//appeding img


        
        const catagoryNews=news.catagoryNews
        const link=news.showmylink
        const showlinkUrl=news.link
        console.log(catagoryNews)

        // Other columns// appending rest of data
        //removing img form discription if exist
        const temp=document.createElement("div")
        temp.innerHTML=news.description
        temp.querySelectorAll("img").forEach(img=> img.remove())
        // console.log("after removing img from description: ",temp.innerHTML)
        const discriptionNews=temp.textContent;
        // console.log("text content of descriptino is :",temp.innerText)
        row.innerHTML += `
          <td>${news.title}</td>
          <td>${discriptionNews}</td>
          <td>${catagoryNews}</td>
          <td>${news.pubDate}</td>
          <td><button class="delete-btn">Delete</button></td>
        `;

        tableBody.appendChild(row);//row append

        //adding news link info starts*******************
         tooltipShow(row,showlinkUrl,link)
        //adding news link info ends*******************


});


}

caller()
 const tableBody = document.querySelector("tbody");

    // Event delegation to handle delete buttons
    tableBody.addEventListener('click', async function(event) {
      if(event.target.classList.contains('delete-btn')) {
        const row = event.target.closest('tr');
        console.log("the row is ",row)

        // console.log("this.row is ",row.cells[2].innerText)
        let discription=row.cells[2].innerText
        await removeData(discription)
      

        row.remove()
        tableBody.innerHTML = "";
        await caller()
        
      }
    });


      async function removeData(params) {
          const bookmarks= await readData("bookmarks",db,loggedInUser);
         
          for (let element of bookmarks)  {
           
            let news=JSON.parse(element)
            let temp=document.createElement("div")
            temp.innerHTML=news.description
            // console.log("news.link is : ",news.link)
            temp.querySelectorAll("img").forEach(img=> img.remove())
            const discriptionNews=temp.textContent;
          
            // console.log("discriptionNews : ",discriptionNews,discriptionNews.length)
            // showStarting(discriptionNews)
            // console.log("params : ",params,params.length)
            
            
            
            if(discriptionNews==params||discriptionNews=='\n'+params)
          {
             const docRef = doc(db, "users", loggedInUser);
              try{
                 await updateDoc(docRef, {
                bookmarks: arrayRemove(element) 
               });
               console.log("removed successfully")

              }catch(error){
                console.log("removal unsccessfull",error)

              }
          }
          else console.log("not equal")
            
          };
        


          
        }
        // function showStarting(c){
        // const first=c[0].charCodeAt(0)
        // console.log("hidden element is : for ",c," is ",JSON.stringify(c[0]),first)
        // }
    
</script>
  

</body>
</html>
