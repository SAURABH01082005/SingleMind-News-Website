<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Account - SingleMind News</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: linear-gradient(to right, #18365b, #225192);
      font-family: Arial, sans-serif;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    .account-container {
      max-width: 1200px;
      margin: 80px auto;
      background: #fff;
      color: #222;
      border-radius: 12px;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.3);
      padding: 30px;
    }

    .account-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .account-header h2{
      margin: 0;
      font-size: 2rem;
      color: #225192;
    }

    .account-header p {
      color: #555;
      margin-top: 8px;
    }

    .bookmark-list {
      width: 100%;
      border-collapse: collapse;
    }

    .bookmark-list th, .bookmark-list td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    .bookmark-list th {
      background: #225192;
      color: #fff;
      font-weight: bold;
    }

    .bookmark-list tr:nth-child(even) {
      background: #f9f9f9;
    }

    .bookmark-list img {
      width: 120px;
      border-radius: 6px;
    }

    .delete-btn {
      background-color: #ff4d4d;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .delete-btn:hover {
      background-color: #e60000;
    }
  </style>
</head>
<body>

  <div class="account-container">
    <div class="account-header">
      <h2 >ðŸ‘¤<span class="username">My Account</span></h2>
      <p>Welcome back, <span class="username">John Doe</span></p>
    </div>

    <h3>ðŸ”– My Bookmarked News</h3>
    <table class="bookmark-list">
      <thead>
        <tr>
          <th>Image</th>
          <th>Title</th>
          <th>Summary</th>
          <th>Category</th>
          <th>Date</th>
          <th>Actions</th> <!-- Added Actions column -->
        </tr>
      </thead>
      <tbody id="bookmarkTableBody">
       
      </tbody>
    </table>
  </div>
  <div class="showlink" >this is your link.........</div>
  <footer> <p>&copy; 2025 SingleMind News. All rights reserved.</p>
        </footer> 

  <script>
   

  </script>

<script type="module">  
const  loggedInUser = localStorage.getItem("loggedInUser");
// const loggedInUser="manoj kurmar yadav"
console.log("checking session ",loggedInUser)
let name=document.querySelectorAll(".username")

name[0].innerText=capitalize(loggedInUser)
name[1].innerText=capitalize(loggedInUser)

function capitalize(l){
 let k= l.split(" ").map(element =>{
  let a=element.split("")
  a[0]=a[0].toUpperCase()

      return a.join("")

  })
  return k.join(" ")
  
}

  //**********************************firebase sdks ****************************************
  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import {
  getFirestore,
  doc,
  getDoc,
  updateDoc,
  arrayUnion,
  arrayRemove
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyC5WPwC7kSpMvVzP8uSwOOOhAx6p52B3z8",
    authDomain: "singlemind-97876.firebaseapp.com",
    projectId: "singlemind-97876",
    storageBucket: "singlemind-97876.firebasestorage.app",
    messagingSenderId: "445373825721",
    appId: "1:445373825721:web:b5ab921e6a7ad577101168"
  };
//***********************************firebase sdk end***********************************
  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
   



//**************fetching data rss**************
async function myfunction(k) {
    const docRef = doc(db, "users", loggedInUser);
    try {
      const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      // console.log("Document data:", docSnap.data());
      if(k=='urls') return docSnap.data().urls
      if(k=='bookmarks') return docSnap.data().bookmarks
      // console.log("function completed")
      
      
    } else {

      console.log("No such document!");
    }
      
    } catch (error) {
    console.log("some error")
      
    }
  
}
async function caller(params) {
 const bookmarks= await myfunction("bookmarks");
 tableBody.innerHTML = "";
// console.log("bookmarks is ",typeof(bookmarks), bookmarks)
bookmarks.forEach(async k => {
  
  let news= JSON.parse(k)
  console.log("news is ",news)
  const row = document.createElement('tr');

        // Image cell
        const imageCell = document.createElement('td');
        const img = document.createElement('img');
        img.src = news.enclosure?.link || "./images/default_img.png" ;
        img.alt = "Image not loaded";
        img.style.width = "200px";
        img.className="rowimg"
        imageCell.appendChild(img);
        row.appendChild(imageCell);//appeding img


        
        const catagoryNews=news.catagoryNews
        const showmylink=news.showmylink
        const link=news.link
        console.log(catagoryNews)

        // Other columns// appending rest of data
        //removing img form discription if exist
        const temp=document.createElement("div")
        temp.innerHTML=news.description
        temp.querySelectorAll("img").forEach(img=> img.remove())
        // console.log("after removing img from description: ",temp.innerHTML)
        const discriptionNews=temp.textContent;
        // console.log("text content of descriptino is :",temp.innerText)
        row.innerHTML += `
          <td>${news.title}</td>
          <td>${discriptionNews}</td>
          <td>${catagoryNews}</td>
          <td>${news.pubDate}</td>
          <td><button class="delete-btn">Delete</button></td>
        `;

        tableBody.appendChild(row);//row append

        //adding news link info starts*******************


        let showlink=document.querySelector('.showlink'); 
        row.addEventListener("mouseover",(event)=>{
          showlink.innerHTML = `<a href='${link}' style='text-decoration: none;color:black;'>${showmylink}</a>`;
          showlink.style.display='block'
          // showlink.style.pointerEvents = "none"; 
          document.body.appendChild(showlink)
          moveTooltip(event);


        })


        row.addEventListener("mouseout", () => {
          showlink.style.display='none';

        });
        showlink.addEventListener("mouseover",(event)=>{
          showlink.style.display='block';
          //  console.log("hovering in showlingk box")

        })

        function moveTooltip(event){
          showlink.style.top=(event.pageY+10) +"px"
          showlink.style.left=(event.pageX+10)+"px"
        }
        //adding news link info ends*******************


});


}

caller()



 const tableBody = document.getElementById('bookmarkTableBody');

    // Event delegation to handle delete buttons
    tableBody.addEventListener('click', async function(event) {
      if(event.target.classList.contains('delete-btn')) {
        const row = event.target.closest('tr');
        // console.log("the row is ",row)

        // console.log("this.row is ",row.cells[2].innerText)
        let discription=row.cells[2].innerText
        await removeData(discription)
      

        row.remove()
        tableBody.innerHTML = "";
        await caller()
        
      }
    });


      async function removeData(params) {
          const bookmarks= await myfunction("bookmarks")
         
          for (let element of bookmarks)  {
           
            let news=JSON.parse(element)
            let temp=document.createElement("div")
            temp.innerHTML=news.description
            // console.log("news.link is : ",news.link)
            temp.querySelectorAll("img").forEach(img=> img.remove())
            const discriptionNews=temp.textContent;
          
            // console.log("discriptionNews : ",discriptionNews,discriptionNews.length)
            // showStarting(discriptionNews)
            // console.log("params : ",params,params.length)
            
            
            
            if(discriptionNews==params||discriptionNews=='\n'+params)
          {
             const docRef = doc(db, "users", loggedInUser);
              try{
                 await updateDoc(docRef, {
                bookmarks: arrayRemove(element) 
               });
               console.log("removed successfully")

              }catch(error){
                console.log("removal unsccessfull",error)

              }
          }
          else console.log("not equal")
            
          };
        


          
        }
        // function showStarting(c){
        // const first=c[0].charCodeAt(0)
        // console.log("hidden element is : for ",c," is ",JSON.stringify(c[0]),first)
        // }
    
</script>
  

</body>
</html>
